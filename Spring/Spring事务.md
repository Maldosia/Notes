# Spring事务

## 1. 传播机制

- PROPAGATION_REQUIRED

  默认。如果外层有事务，则加入到外层事务，同时提交，同时回滚。

- PROPAGATION_REQUES_NEW

  每次都开启一个新的事务，同时把外层事务挂起，当前事务执行完毕后，恢复上层事务的执行。如果外层没有事务，则新开启一个事务。

- PROPAGATION_SUPPORT

  如果外层有事务，则加入；如果外层没有事务，则以非事务的方式运行。完全依赖外层事务。

- PROPAGATION_NOT_SUPPORT

  如果外层有事务，则外层事务挂起，直到执行完当前代码，恢复外层事务。不论是否异常，都不会影响外层事务。

- PROPAGATION_NEVER

  如果外层有事务，则报错。

- PROPAGATION_MANDAORY

  如果外层没有事务，则报错。

- PROPAGATION_NESTED

  可以保存状态保存点，当前事务回滚到某一个点，从而避免所有的嵌套事务都回滚，即各自回滚各自的，如果子事务没有把异常吃掉，则回滚全部。

## 2. 隔离级别

### 2.1 问题

#### 2.1.1 脏读

#### 2.1.2 不可重复读

#### 2.1.3 幻读

### 2.2 隔离级别

#### 2.2.1  

#### 2.2.2

#### 2.2.3

#### 2.2.4

#### 2.2.5

## 3.事务失效

### 3.1 事务注解@transcational只能放在public修饰的方法上

### 3.2 Mysql的存储引擎是MyISAM，MyISAM不支持事务

InnoDB引擎支持事务。

### 3.3 业务代码抛出的异常不是RuntimeException异常

抛出Exception异常也不会回滚。

### 3.4 同一类的方法A调用方法B，方法B上有@transactional，则方法B的事务不会生效

原因是在同一个类中互相调用导致切面失效，此时不仅仅是事务失效。